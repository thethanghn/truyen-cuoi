<div class="narrator" style="position:fixed; left: 30px; bottom: 30px;">
  <div class="nar-inner">
    <%= image_tag 'narrator1.png', class: 'img-circle nar-img-1' %>
  </div>
  <div class="nar-inner2" style="display: none;">
    <%= image_tag 'narrator2.png', class: 'img-circle nar-img-2'%>
  </div>
</div>

<script type="text/javascript">
var data = [
  [0, 'Let here me out...'],
  [1, 'I want to tell you something.'],
  [1, 'That is really important...'],
  [2, 'Hm...'],
  [1, 'Suddenly I forgot...'],
  [1, 'Unfortunately but I cannot remember it...'],
  [1, 'I am absent minded, you know...'],
  [2, 'See you then.'],
  [4, 'Oh I remember it...'],
  [2, "I'd like to say..."],
  [2, "That is..."],
  [3, 'I miss you...'],
  [2, ":'("],
];

var alphabet = 'abcdefghijklmnopqrstvuwxyzABCDEFGHIJKLMNOPQRSTUWXYZ';
var tiles = [2,1,3,4,2,1,3,2,1,3,4,2,3,2,4,1,1,2,3,1,4,1,1,2,1,2,2,4,1,1,2,1,2,2,4,1,2,3,4,2,3,1,4,2,1,4,1,3,1,4,1,2];
var speed = 500;
var cur = 0;
var curW = 0;
var wordSpeakingId = 0;
$(function(){
  setInterval(run, 2000);
});

function run() {
  if (cur < data.length) {
    var settings = data[cur];
    setTimeout(function(){
      speak(settings[1]);
    }, settings[0]* 1000);
    cur++;
  }
}

function speak(paragraph) {
  $('.narrator').popover('destroy');
  $('.narrator').popover({
    animation: false,
    placement: 'top',
    trigger: 'manual',
    content: paragraph
  }).popover('show');
  //split to word
  var words = paragraph.split(' ');
  //try to read each
  curW = 0;
  readWord(words);
}

function readWord(words) {
  if (curW < words.length) {
    var w = words[curW];
    curW++;
    if (w.length == 0) return;
    var firstChar = w[0];
    if (alphabet.indexOf(firstChar) != -1) {
      var tile = tiles[alphabet.indexOf(firstChar)];
//      alert(tile);
      swapTile(tile);
    }
  }
}

function swapTile(tile) {
  $('.img-circle').hide();
  $('.nar-inner img').attr('src', '/assets/narrator' + tile +'.png').show();
}

function xxx(){
    $n1 = $('.narrator1');
    $n2 = $('.narrator2');
    if ($n2.is(':visible')) {
      $n1.fadeIn(500, function(){
        $('.nar-img-1').popover({
          animation: false,
          placement: 'top',
          trigger: 'manual',
          content: 'ahahahah'
        }).popover('show');
      });
      $n2.fadeOut();
    } else {
      $n2.fadeIn();
      $n1.fadeOut();      
    }
  }

</script>
